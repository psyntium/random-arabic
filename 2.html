<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    
    <title>Random Arabic Words</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" />

    <link href='https://fonts.googleapis.com/css?family=Noto%20Naskh%20Arabic' rel='stylesheet'>
    
    <style>
        #word {
            font-family: 'Noto Naskh Arabic';
            padding: 10% 0%;
            overflow: scroll;
            white-space: nowrap;
        }

        #border {
            width: 5%;
        }
    </style>
</head>

<body id="body" class="p-0 m-0 text-center overflow-hidden">
    <header class="mb-auto">
        <div class="">
            <h3 class="float-md-start border-bottom border-1 border-dark py-2 w-100">Random Arabic Words : 2 Words</h3>

            <nav class="nav justify-content-end">
                <a id="btnHome" class="nav-link ps-0 text-dark fs-3" href="index.html"><i class="bi-house"></i></a>
            </nav>
        </div>
    </header>
    
    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">

    <main class="">

        <div id="word" class="w-100 position-fixed top-50 start-50 translate-middle"></div>

    </main>
    
    </div>

    <footer class="position-fixed bottom-0 p-3 w-100">
        <div class="row">
            <div class="col d-grid">
                <button id="prev" type="button" class="btn btn-primary btn-lg"><i class="bi-chevron-double-left"></i></button>
            </div>
            <div class="col d-grid">
                <button id="next" type="button" class="btn btn-success btn-lg"><i class="bi-chevron-double-right"></i></button>
            </div>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

    <script type="text/javascript">
        const TOTAL_SENTENCE = 6236;
        const QURAN_ENDPOINT = "https://api.alquran.cloud/v1/ayah"
        const QURAN_MUSHAF = "quran-uthmani"

        const words = [];
        const prevWords = [];
        var currentWord = "";

        function nextWord() {
            if (words.length === 0) {
                return getSentence(nextWord)
            }

            var word = "";
            while (word === "" && words.length > 0) {
                word = words.pop()
                if (currentWord === word) {
                    prevWords.push(word);
                    word = ""
                }
            }

            if (words.length === 0) {
                return getSentence(nextWord)
            }

            currentWord = word;
            prevWords.push(word);
            $("#word").html(word);

            setSize();
        }

        function prevWord() {
            if (prevWords.length === 0)
                return;

            var word = "";
            while (word === "" && prevWords.length > 0) {
                word = prevWords.pop()
                if (currentWord === word) {
                    words.push(word);
                    word = ""
                }
            }

            if (word) {
                currentWord = word;
                words.push(word);
                $("#word").html(word);

                setSize();
            }
        }

        function setSize() {
            var dominator = 2;
            $("#word").css("font-size", window.innerHeight / dominator);
            while ($("#word")[0].scrollWidth > $("#word").width()) {
                dominator++;
                $("#word").css("font-size", window.innerHeight / dominator);
            }
            dominator++;
            $("#word").css("font-size", window.innerHeight / dominator);
        }

        function getSentence(cb) {
            const num = Math.floor(Math.random() * TOTAL_SENTENCE)
            $.getJSON(QURAN_ENDPOINT + "/" + num + "/" + QURAN_MUSHAF, function (data) {
                if (!data || !data.data || !data.data.text) {
                    console.log(JSON.stringify(data));
                    throw "invalid data"
                }

                w = data.data.text.split(" ");

                w.forEach((word) => {
                    word = word.replace(" ۖ", "");
                    word = word.replace(" ۚ", "");
                    word = word.replace(" ۗ", "");
                    word = word.replace(" ۚ", "");
                    word = word.replace("۞", "");
                    word = word.replace("۞", "");
                    word = word.replace("", "");

                    if (word.length === 1) word = "";
                    words.push(word);
                })
                shuffleArray(words);
                return cb()
            });
        }

        function shuffleArray(array) {
            var newArray = [];
            array.forEach(function (word, i) {
                if (array[i+1])
                    newArray.push(word + " " + array[i+1])
            })
            for (var i = newArray.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = newArray[i];
                newArray[i] = newArray[j];
                newArray[j] = temp;
            }
            while (array.length) { array.pop(); }
            newArray.forEach(function(words) {
                array.push(words);
            })
            
        }

        $(document).ready(function () {
            getSentence(function () {
                nextWord();
            });

            $("#next").click(nextWord)
            $("#prev").click(prevWord)
            $(window).resize(setSize);
        })

    </script>
</body>

</html>
